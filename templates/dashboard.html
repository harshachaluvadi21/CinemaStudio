{% extends "base.html" %}
{% block title %}Dashboard â€” Cinema Studio{% endblock %}

{% block content %}
<div class="dashboard">

    <!-- â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar__brand">
            <span class="sidebar__icon">ğŸ¬</span>
            <span class="sidebar__name">Cinema Studio</span>
        </div>

        <nav class="sidebar__nav">
            <a href="#story-input" class="sidebar__link sidebar__link--active" data-section="story-input"
                id="nav-story">
                <span class="sidebar__link-icon">âœï¸</span>
                <span>Story Input</span>
            </a>
            <a href="#screenplay" class="sidebar__link disabled" data-section="screenplay" id="nav-screenplay">
                <span class="sidebar__link-icon">ğŸ“œ</span>
                <span>Screenplay</span>
            </a>
            <a href="#characters" class="sidebar__link disabled" data-section="characters" id="nav-characters">
                <span class="sidebar__link-icon">ğŸ­</span>
                <span>Characters</span>
            </a>
            <a href="#sound" class="sidebar__link disabled" data-section="sound" id="nav-sound">
                <span class="sidebar__link-icon">ğŸµ</span>
                <span>Sound Design</span>
            </a>
        </nav>

        <div class="sidebar__footer">
            <!-- Project Actions -->
            <div class="sidebar__actions"
                style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border);">
                <button class="btn btn--outline btn--sm btn--full" onclick="saveProject()">ğŸ’¾ Save Project</button>
                <button class="btn btn--outline btn--sm btn--full"
                    onclick="document.getElementById('loadInput').click()">ğŸ“‚ Load Project</button>
                <input type="file" id="loadInput" style="display: none;" accept=".json" onchange="loadProject(this)">
            </div>

            <div class="sidebar__user">
                <div class="sidebar__avatar">{{ username[0].upper() }}</div>
                <span class="sidebar__username">{{ username }}</span>
            </div>
            <a href="{{ url_for('auth.logout') }}" class="btn btn--ghost btn--sm">Exit</a>
        </div>
    </aside>

    <!-- â”€â”€ Mobile header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <header class="mobile-header">
        <button class="hamburger" id="hamburger" aria-label="Toggle menu">â˜°</button>
        <span class="mobile-header__title">ğŸ¬ Cinema Studio</span>
        <a href="{{ url_for('auth.logout') }}" class="btn btn--ghost btn--sm">Exit</a>
    </header>

    <!-- â”€â”€ Main content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <main class="main-content">

        <!-- Story Input Section -->
        <section class="content-section active" id="story-input">
            <div class="section-header">
                <h2 class="section-title">âœï¸ Your Story Concept</h2>
                <p class="section-desc">Describe your story idea and let the AI craft a full screenplay, character
                    profiles, and sound design notes.</p>
            </div>

            <div class="story-card">
                <label class="form-label" for="storylineInput">Story Concept</label>

                <div class="form-row" style="margin-bottom: 1rem;">
                    <select class="form-input form-select" id="genreSelect">
                        <option value="Cinematic Default">ğŸ¬ Cinematic Default</option>
                        <option value="Film Noir">ğŸ•µï¸â€â™‚ï¸ Film Noir</option>
                        <option value="Sci-Fi / Cyberpunk">ğŸ¤– Sci-Fi / Cyberpunk</option>
                        <option value="Fantasy / Adventure">ğŸ‰ Fantasy / Adventure</option>
                        <option value="Psychological Thriller">ğŸ§  Psychological Thriller</option>
                        <option value="Slapstick Comedy">ğŸŒ Slapstick Comedy</option>
                        <option value="Period Drama">ğŸ° Period Drama</option>
                        <option value="Horror">ğŸ‘» Horror</option>
                    </select>
                </div>

                <textarea class="story-textarea" id="storylineInput"
                    placeholder="e.g. A reclusive inventor discovers an alien artifact under his barn in 1950s rural Montanaâ€¦"
                    maxlength="2000" rows="6"></textarea>

                <div class="character-names-config" style="margin-top: 1.5rem;">
                    <label class="form-label" for="characterNamesInput">Desired Characters (Optional)</label>
                    <input type="text" class="form-input" id="characterNamesInput"
                        placeholder="e.g. Arjun (a brave cop), Priya (his sister)"
                        style="width: 100%; margin-top: 0.5rem;">
                </div>
                <div class="story-meta">
                    <span class="char-counter"><span id="charCount">0</span> / 2000</span>
                </div>

                <button class="btn btn--primary btn--generate" id="generateBtn" onclick="generateContent()">
                    <span class="btn-text">ğŸ¬ Generate Script</span>
                    <span class="btn-spinner" style="display:none;">
                        <span class="spinner spinner--sm"></span> Generatingâ€¦
                    </span>
                </button>
            </div>

            <!-- Error display -->
            <div class="alert alert--error" id="generateError" style="display:none;"></div>

            <!-- Quick-nav to results (hidden until generated) -->
            <div class="results-nav" id="resultsNav" style="display:none;">
                <p class="results-nav__label">Jump to:</p>
                <button class="btn btn--outline btn--sm" onclick="showSection('screenplay')">ğŸ“œ Screenplay</button>
                <button class="btn btn--outline btn--sm" onclick="showSection('characters')">ğŸ­ Characters</button>
                <button class="btn btn--outline btn--sm" onclick="showSection('sound')">ğŸµ Sound Design</button>
            </div>
        </section>

        <!-- Screenplay Section -->
        <section class="content-section" id="screenplay">
            <div class="section-header">
                <h2 class="section-title">ğŸ“œ Screenplay</h2>
                <div class="export-bar">
                    <button class="btn btn--outline btn--sm" onclick="speakScreenplay()" id="speakBtn">
                        <span class="btn-icon">ğŸ§</span> Listen
                    </button>
                    <div class="divider-vertical"></div>
                    <span class="export-label">Export:</span>
                    <button class="btn btn--export" onclick="exportSection('screenplay','txt')">TXT</button>
                    <button class="btn btn--export" onclick="exportSection('screenplay','pdf')">PDF</button>
                    <button class="btn btn--export" onclick="exportSection('screenplay','docx')">DOCX</button>
                </div>
            </div>

            <div class="output-placeholder" id="screenplay-placeholder">
                <div class="placeholder-icon">ğŸ“œ</div>
                <p>Your screenplay will appear here after generation.</p>
            </div>
            <pre class="screenplay-output output-block" id="screenplay-output" style="display:none;"></pre>
        </section>

        <!-- Characters Section -->
        <section class="content-section" id="characters">
            <div class="section-header">
                <h2 class="section-title">ğŸ­ Character Profiles</h2>
                <div class="export-bar">
                    <button class="btn btn--outline btn--sm" onclick="showRenameModal()" style="margin-right: 0.5rem;">
                        <span class="btn-icon">âœï¸</span> Rename All
                    </button>
                    <div class="divider-vertical"></div>
                    <span class="export-label">Export:</span>
                    <button class="btn btn--export" onclick="exportSection('characters','txt')">TXT</button>
                    <button class="btn btn--export" onclick="exportSection('characters','pdf')">PDF</button>
                    <button class="btn btn--export" onclick="exportSection('characters','docx')">DOCX</button>
                </div>
            </div>

            <div class="output-placeholder" id="characters-placeholder">
                <div class="placeholder-icon">ğŸ­</div>
                <p>Character profiles will appear here after generation.</p>
            </div>
            <div class="characters-output output-block" id="characters-output" style="display:none;"></div>
        </section>

        <!-- Sound Design Section -->
        <section class="content-section" id="sound">
            <div class="section-header">
                <h2 class="section-title">ğŸµ Sound Design</h2>
                <div class="export-bar">
                    <span class="export-label">Export:</span>
                    <button class="btn btn--export" onclick="exportSection('sound','txt')">TXT</button>
                    <button class="btn btn--export" onclick="exportSection('sound','pdf')">PDF</button>
                    <button class="btn btn--export" onclick="exportSection('sound','docx')">DOCX</button>
                </div>
            </div>

            <div class="output-placeholder" id="sound-placeholder">
                <div class="placeholder-icon">ğŸµ</div>
                <p>Sound design notes will appear here after generation.</p>
            </div>
            <div class="sound-output output-block" id="sound-output" style="display:none;"></div>
        </section>

    </main>
</div>

<!-- Rename Everywhere Modal -->
<div id="renameModal" class="loading-overlay"
    style="display:none; align-items: center; justify-content: center; z-index: 10001; background: rgba(10, 11, 14, 0.95);">
    <div class="loading-card" style="max-width: 400px; text-align: left; animation: fadeInScale 0.3s ease-out;">
        <h2 style="font-family: 'Playfair Display', serif; color: var(--gold); margin-bottom: 1rem; font-size: 1.5rem;">
            Rename Everywhere</h2>
        <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1.5rem; line-height: 1.4;">
            This will update the character name across the Screenplay, Profiles, and Sound Design sections instantly.
        </p>

        <div style="margin-bottom: 1rem;">
            <label
                style="display: block; color: var(--gold); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem;">Current
                Name</label>
            <input type="text" id="oldNameInput" class="form-input" placeholder="e.g. Arjun" style="width: 100%;">
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label
                style="display: block; color: var(--gold); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem;">New
                Name</label>
            <input type="text" id="newNameInput" class="form-input" placeholder="e.g. Rahul" style="width: 100%;">
        </div>

        <div style="display: flex; gap: 0.75rem;">
            <button class="btn btn--primary btn--sm" onclick="renameCharacter()" style="flex: 1;">Apply Changes</button>
            <button class="btn btn--ghost btn--sm" onclick="closeRenameModal()" style="flex: 1;">Cancel</button>
        </div>
    </div>
</div>

<style>
    @keyframes fadeInScale {
        from {
            opacity: 0;
            transform: scale(0.95);
        }

        to {
            opacity: 1;
            transform: scale(1);
        }
    }
</style>

<!-- Full-screen loading overlay -->
<div class="loading-overlay" id="loadingOverlay" style="display:none;">
    <div class="loading-card">
        <div class="film-reel">
            <div class="film-reel-core"></div>
        </div>
        <p class="loading-title">Crafting your storyâ€¦</p>
        <p class="loading-sub">The AI is writing your screenplay, characters, and sound design. This may take a moment.
        </p>
    </div>
</div>
{% endblock %}